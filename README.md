# Obsidian Agent Kit (OAK)

![Version](https://img.shields.io/badge/version-1.1.0-blue.svg)
![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)

**OAK (Obsidian Agent Kit)** æ˜¯ä¸€ä¸ªä¸º Obsidian æ‰“é€ çš„**ä¼ä¸šçº§ AI ä»£ç†å¼€å‘æ¡†æ¶**ã€‚

å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ’ä»¶ï¼Œæ›´æ˜¯ä¸€å¥—æ ‡å‡†çš„**å¼‚æ­¥ç”Ÿäº§ç®¡çº¿**ã€‚å®ƒæ—¨åœ¨è§£å†³ Obsidian AI å¼€å‘ä¸­çš„æ ¸å¿ƒç—›ç‚¹ï¼šä¸»çº¿ç¨‹é˜»å¡ã€API ç¨³å®šæ€§å·®ã€ä»¥åŠç¼ºä¹ç»Ÿä¸€çš„æ’ä»¶é—´é€šä¿¡æœºåˆ¶ã€‚

---

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§ (Core Features)

### 1. ğŸ›¡ï¸ åšå¦‚ç£çŸ³çš„ LLM åŸºç¡€è®¾æ–½
* **é›¶åœæœºè®¾è®¡ (Zero Downtime)**: å†…ç½®**è‡ªåŠ¨æ•…éšœè½¬ç§»**æœºåˆ¶ã€‚é¦–é€‰ API (å¦‚ OpenAI) å“åº”å¤±è´¥æˆ–è¶…æ—¶ï¼Œä¼šè‡ªåŠ¨æ— ç¼åˆ‡æ¢è‡³å¤‡ç”¨æä¾›å•† (å¦‚ Google Gemini)ã€‚
* **æ™ºèƒ½ Key è½®è¯¢**: æ”¯æŒé…ç½®å¤šä¸ª API Keyã€‚å½“æŸä¸ª Key è§¦å‘é€Ÿç‡é™åˆ¶ (429) æˆ–é¢åº¦ä¸è¶³æ—¶ï¼Œä¼šè‡ªåŠ¨å†·å´å¹¶åˆ‡æ¢ä¸‹ä¸€ä¸ª Keyã€‚

### 2. ğŸ§  äº‹ä»¶é©±åŠ¨è°ƒåº¦ (Event-Driven Orchestrator)
* **éé˜»å¡é˜Ÿåˆ—**: æ‰€æœ‰çš„é‡å‹ AI ä»»åŠ¡éƒ½åœ¨åå°é˜Ÿåˆ—ä¸­å¼‚æ­¥å¤„ç†ï¼Œç»ä¸å¡é¡¿ Obsidian ç•Œé¢ã€‚
* **æŒä¹…åŒ–ä¸æ–­ç‚¹ç»­ä¼ **: ä»»åŠ¡é˜Ÿåˆ—ç‹¬ç«‹å­˜å‚¨ã€‚å³ä½¿ Obsidian æ„å¤–å´©æºƒï¼Œé‡å¯å OAK ä¼šè‡ªåŠ¨ä»æ–­ç‚¹å¤„ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚
* **å…¨å±€äº‹ä»¶æ€»çº¿**: é€šè¿‡ `EventBus` å¹¿æ’­ä»»åŠ¡çŠ¶æ€ï¼Œå…¶ä»–æ’ä»¶å¯å®æ—¶ç›‘å¬ä»»åŠ¡å®Œæˆæƒ…å†µã€‚

### 3. ğŸ”Œ å¼€æ”¾çš„ API ç”Ÿæ€
* **åŒæ­¥/å¼‚æ­¥åŒæ¨¡**: æ—¢æ”¯æŒåå°é•¿ä»»åŠ¡ (`dispatch`)ï¼Œä¹Ÿæ”¯æŒå³æ—¶å¯¹è¯æ¥å£ (`chat`)ï¼Œä¾›èŠå¤©ç±»æ’ä»¶ç›´æ¥è°ƒç”¨ã€‚
* **è·¨æ’ä»¶åä½œ**: ä»»æ„ Obsidian æ’ä»¶å‡å¯é€šè¿‡ `app.plugins.plugins['obsidian-agent-kit'].api` è°ƒç”¨ OAK èƒ½åŠ›ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ (ç”¨æˆ·æ¨¡å¼)

OAK å†…ç½®äº†ä¸€ä¸ªå¼ºå¤§çš„ **"æ·±åº¦æ¦‚å¿µç”Ÿæˆå™¨"** Agentã€‚

1.  **é…ç½®**: 
    * è¿›å…¥è®¾ç½®ï¼Œå¡«å…¥ OpenAI æˆ– Google Gemini çš„ API Key (æ”¯æŒå¤šè¡Œå¡«å…¥å¤šä¸ª)ã€‚
    * å¼€å¯ **Debug Mode** å¯åœ¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†çš„è°ƒåº¦æ—¥å¿—ã€‚
2.  **ä½¿ç”¨**:
    * **æ–¹å¼ A**: ç‚¹å‡»ä¾§è¾¹æ æœºå™¨äººå›¾æ ‡ ğŸ¤–ã€‚
    * **æ–¹å¼ B**: ä½¿ç”¨å‘½ä»¤é¢æ¿ `CMD/Ctrl + P` -> `OAK: æ·»åŠ æ–°æ¦‚å¿µåˆ°ç”Ÿæˆé˜Ÿåˆ—`ã€‚
3.  **è¾“å…¥**: 
    * è¾“å…¥ä¸€ä¸ªæ¦‚å¿µï¼ˆä¾‹å¦‚ï¼šâ€œç¬¬ä¸€æ€§åŸç†â€æˆ–â€œç†µå¢å®šå¾‹â€ï¼‰ã€‚
    * OAK ä¼šåœ¨åå°è‡ªåŠ¨æ ¹æ®ç¬¬ä¸€æ€§åŸç†è¿›è¡Œæ·±åº¦æ¨å¯¼ï¼Œç”ŸæˆåŒ…å« Mermaid å›¾è¡¨ä¸ç»“æ„åŒ–çŸ¥è¯†çš„ç²¾ç¾ç¬”è®°ã€‚

---

## ğŸ§‘â€ğŸ’» å¼€å‘è€…æŒ‡å—ï¼šæ„å»ºä¸é›†æˆ

OAK çš„è®¾è®¡å“²å­¦æ˜¯ï¼š**"ä½ åªç®¡å†™ä¸šåŠ¡é€»è¾‘ï¼Œå‰©ä¸‹çš„ï¼ˆé‡è¯•ã€å¹¶å‘ã€æŒä¹…åŒ–ï¼‰äº¤ç»™æ¡†æ¶"**ã€‚

### 1. å¤–éƒ¨æ’ä»¶è°ƒç”¨ (Integration)

å¦‚æœä½ çš„æ’ä»¶éœ€è¦ AI èƒ½åŠ›ï¼Œæ— éœ€è‡ªå·±å®ç° HTTP è¯·æ±‚ï¼Œç›´æ¥è°ƒç”¨ OAKï¼š

```typescript
// è·å– OAK API å®ä¾‹
const oak = this.app.plugins.plugins['obsidian-agent-kit']?.api;

if (oak) {
    // åœºæ™¯ 1: ç®€å•çš„å³æ—¶å¯¹è¯ (åŒæ­¥)
    const answer = await oak.chat("å¦‚ä½•ç”¨ä¸€å¥è¯è§£é‡Šé‡å­çº ç¼ ï¼Ÿ");
    console.log(answer);

    // åœºæ™¯ 2: æ´¾å‘è€—æ—¶ä»»åŠ¡åˆ°åå°é˜Ÿåˆ— (å¼‚æ­¥)
    // ç«‹å³è¿”å› taskIdï¼Œä¸ä¼šé˜»å¡ç•Œé¢
    const taskId = await oak.dispatch(
        "generation_queue",      // ç›®æ ‡é˜Ÿåˆ—å
        { concept: "å…ƒå®‡å®™" },   // ä»»åŠ¡è½½è·
        "My-Plugin-ID"           // æ¥æºæ ‡è¯†
    );

    // åœºæ™¯ 3: ç›‘å¬ä»»åŠ¡å®Œæˆäº‹ä»¶
    oak.on('oak:task-completed', (task) => {
        if (task.id === taskId) {
            new Notice(`ä½ çš„ä»»åŠ¡ ${task.concept} å·²å®Œæˆï¼`);
        }
    });
}
````

### 2\. å¼€å‘è‡ªå®šä¹‰ Agent (Native Extension)

å¦‚æœä½ åœ¨åŸºäº OAK æºç å¼€å‘ï¼Œåªéœ€ç»§æ‰¿ `BaseAgent`ï¼š

```typescript
import { BaseAgent } from "../core/BaseAgent";

export class SummarizerAgent extends BaseAgent<MyTaskType> {
    // å®šä¹‰é˜Ÿåˆ—åç§° (å…¨å±€å”¯ä¸€)
    get queueName(): string { return "summarize_queue"; }

    async process(task: MyTaskType): Promise<boolean> {
        // 1. ä½¿ç”¨å†…ç½®çš„é«˜å¯ç”¨ LLM å®ä¾‹
        const summary = await this.llm.chat(`æ€»ç»“: ${task.content}`);
        
        if (!summary) return false; // è¿”å› false ä¼šè§¦å‘æ¡†æ¶çš„è‡ªåŠ¨é‡è¯•æœºåˆ¶

        // 2. å†™å…¥æ–‡ä»¶
        await this.app.vault.create(task.targetPath, summary);
        
        return true; // ä»»åŠ¡æˆåŠŸ
    }
}
```

ç„¶åå¹¶åœ¨ `main.ts` ä¸­æ³¨å†Œï¼š

```typescript
this.api.registerAgent(new SummarizerAgent(this, this.llm));
```

-----

## ğŸ“‚ é¡¹ç›®ç»“æ„

  * `src/core/Orchestrator.ts`: è°ƒåº¦æ ¸å¿ƒï¼Œè´Ÿè´£é˜Ÿåˆ—å¾ªç¯ä¸ä»»åŠ¡åˆ†å‘ã€‚
  * `src/core/LLMProvider.ts`: è´Ÿè´£ä¸ AI æ¨¡å‹çš„é€šä¿¡ï¼ŒåŒ…å«æ•…éšœè½¬ç§»ä¸ Key è½®æ¢é€»è¾‘ã€‚
  * `src/core/Persistence.ts`: å¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„å­˜ç›˜ä¸è¯»å–ã€‚
  * `src/api.ts`: å®šä¹‰å¯¹å¤–æš´éœ²çš„å…¬å…±æ¥å£ã€‚
  * `prompts/`: å­˜æ”¾ç‰ˆæœ¬åŒ–çš„æç¤ºè¯æ¨¡æ¿ã€‚

-----

## ğŸ“„ è®¸å¯è¯

[MIT](https://www.google.com/search?q=LICENSE)

```
```